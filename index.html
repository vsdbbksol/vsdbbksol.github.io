<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <!-- –í–ê–ñ–ù–û: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π meta-viewport –¥–ª—è safe area –∏ –∑–∞–ø—Ä–µ—Ç–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

  <title>TMA</title>
   
  <!-- Telegram WebApp script -->
  <script src="https://telegram.org/js/telegram-web-app.js?59"></script>

  <style>
    body {
      margin: 0;
      padding: 0; /* –£–±–∏—Ä–∞–µ–º padding, —á—Ç–æ–±—ã iframe –±—ã–ª –≤–ø–ª–æ—Ç–Ω—É—é –∫ –∫—Ä–∞—è–º */
      font-family: -apple-system, BlinkMacSystemFont, avenir next, avenir, segoe ui, helvetica neue, Adwaita Sans, Cantarell, Ubuntu, roboto, noto, helvetica, arial, sans-serif;
      background: #fff;
      
      /* –í–∞–∂–Ω–æ –¥–ª—è safe area –Ω–∞ iOS */
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    iframe {
      width: 100%;
      max-width: 100%;
      height: 600px;
      border: none;
      display: block;
      margin: 0 auto;
      
      /* –í–∞–∂–Ω–æ: —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –≤–Ω—É—Ç—Ä–∏ iframe */
      touch-action: pan-y;
      -webkit-overflow-scrolling: touch;
    }

    .loading {
      text-align: center;
      padding: 20px;
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
    }

    @media (max-width: 768px) {
      iframe { height: 500px; }
    }

    @media (max-width: 480px) {
      iframe { height: 400px; }
    }
  </style>
</head>

<body>

  <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ä–º—ã...</div>

  <script>
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM WEBAPP
    // ============================================
    const tg = window.Telegram.WebApp;
    
    // ------------------------------------------------------------
    // –ò–¢–û–ì–û–í–´–ô –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –§–ò–ö–° –î–õ–Ø –ü–†–û–ö–†–£–¢–ö–ò –í TMA
    // ------------------------------------------------------------
    
    // 1. –û–§–ò–¶–ò–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï Telegram (Bot API 7.7+)
    if (typeof tg.disableVerticalSwipes === 'function') {
      tg.disableVerticalSwipes();
      console.log('‚úÖ Vertical swipes disabled');
    } else {
      console.log('‚ö†Ô∏è disableVerticalSwipes –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback');
      
      // 2. –°–¢–†–ê–•–û–í–ö–ê –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º–æ–π
      const ensureScrollable = () => {
        if (document.documentElement.scrollHeight <= window.innerHeight) {
          document.documentElement.style.setProperty('height', 'calc(100vh + 2px)', 'important');
        }
        
        // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–∞—ë–º scrollY –±—ã—Ç—å 0
        if (window.scrollY === 0) {
          window.scrollTo(0, 1);
        }
      };
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      ensureScrollable();
      
      // –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∫–∞—Å–∞–Ω–∏–∏ —ç–∫—Ä–∞–Ω–∞
      document.body.addEventListener('touchstart', ensureScrollable);
      
      // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
      window.addEventListener('resize', ensureScrollable);
    }
    
    // 3. –§–ò–ö–° SAFE AREA –î–õ–Ø iOS
    if (window.visualViewport) {
      const fixSafeArea = () => {
        document.body.style.height = window.visualViewport.height + 'px';
      };
      
      window.visualViewport.addEventListener('resize', fixSafeArea);
      // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤
      fixSafeArea();
    }
    
    // 4. –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    tg.expand();
    
    // ============================================
    // –ü–û–õ–£–ß–ï–ù–ò–ï TELEGRAM ID
    // ============================================
    let telegramId = '';
    let userData = {};
    
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      telegramId = String(tg.initDataUnsafe.user.id);
      userData = tg.initDataUnsafe.user;
      console.log('üì± Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', telegramId);
    } else {
      telegramId = '123456789'; // –¢–µ—Å—Ç–æ–≤—ã–π ID
      console.warn('‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ID: 123456789');
    }

    // ============================================
    // –°–û–ó–î–ê–ù–ò–ï IFRAME –° –ü–ê–†–ê–ú–ï–¢–†–û–ú –í URL
    // ============================================
    function createIframeWithTelegramId() {
      const container = document.body;
      
      // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–π iframe –µ—Å–ª–∏ –µ—Å—Ç—å
      const oldIframe = document.querySelector('iframe');
      if (oldIframe) oldIframe.remove();
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      document.getElementById('loading').style.display = 'block';
      
      // –í–ê–ñ–ù–û: –∑–∞–º–µ–Ω–∏—Ç–µ –ò–ú–Ø_–ü–û–õ–Ø –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏–∑ –≤–∞—à–µ–π —Ñ–æ—Ä–º—ã
      // –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ short text
      const fieldName = 'answer_short_text_9008969702497836';
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å Telegram ID
      const formUrl = `https://forms.yandex.ru/cloud/638f4e9390fa7b1cb30872ac/?iframe=1&${fieldName}=${encodeURIComponent(telegramId)}`;
      
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π iframe
      const iframe = document.createElement('iframe');
      iframe.src = formUrl;
      iframe.frameBorder = '0';
      iframe.name = 'ya-form-638f4e9390fa7b1cb30872ac';
      iframe.style.width = '100%';
      iframe.style.height = '600px';
      iframe.style.border = 'none';
      
      // –í–ê–ñ–ù–û: —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –≤–Ω—É—Ç—Ä–∏ iframe
      iframe.setAttribute('scrolling', 'yes');
      iframe.setAttribute('seamless', 'seamless');
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ iframe
      iframe.onload = function() {
        document.getElementById('loading').style.display = 'none';
        console.log('‚úÖ –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å ID:', telegramId);
        
        // –ü—Ä–æ–±—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å–∫—Ä–æ–ª–ª–∏—Ç—å
        setTimeout(() => window.scrollTo(0, 1), 100);
      };
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
      iframe.onerror = function() {
        document.getElementById('loading').style.display = 'none';
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ä–º—ã');
      };
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
      container.appendChild(iframe);
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ iframe –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', createIframeWithTelegramId);
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É, –µ—Å–ª–∏ load –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
    setTimeout(createIframeWithTelegramId, 1000);
    
    // ============================================
    // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô –§–ò–ö–° –î–õ–Ø iOS WEBVIEW
    // ============================================
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –Ω–∞ iOS
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
      const style = document.createElement('style');
      style.textContent = `
        ::-webkit-scrollbar {
          -webkit-appearance: none;
          width: 7px;
        }
        ::-webkit-scrollbar-thumb {
          border-radius: 4px;
          background-color: rgba(0,0,0,0.3);
          -webkit-box-shadow: 0 0 1px rgba(255,255,255,0.5);
        }
      `;
      document.head.appendChild(style);
    }
  </script>

</body>
</html>
