<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>TMA</title>
  <script src="https://telegram.org/js/telegram-web-app.js?59"></script>

  <style>
    /* –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–´–ô –†–ï–ñ–ò–ú */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden !important;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, avenir next, avenir, segoe ui, helvetica neue, Adwaita Sans, Cantarell, Ubuntu, roboto, noto, helvetica, arial, sans-serif;
      background: #fff;
      display: flex;
      flex-direction: column;
    }

    /* –ö–û–ù–¢–ï–ô–ù–ï–† –° –ü–†–û–ö–†–£–¢–ö–û–ô */
    .scrollable-container {
      flex: 1;
      width: 100%;
      height: 100%;
      overflow-y: auto !important;
      overflow-x: hidden !important;
      -webkit-overflow-scrolling: touch !important;
      position: relative !important;
    }

    /* IFRAME */
    iframe {
      width: 100%;
      border: none;
      display: block;
      background: white;
      height: 100vh; /* –í–†–ï–ú–ï–ù–ù–û, –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–ò–ú */
      min-height: 100vh;
    }

    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      z-index: 10000;
      display: none;
    }
  </style>
</head>

<body>

  <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ä–º—ã...</div>
  
  <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –° –ü–†–û–ö–†–£–¢–ö–û–ô -->
  <div id="scrollContainer" class="scrollable-container"></div>

  <script>
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM
    // ============================================
    const tg = window.Telegram.WebApp;
    
    if (typeof tg.disableVerticalSwipes === 'function') {
      tg.disableVerticalSwipes();
    }
    
    tg.expand();
    
    let telegramId = '123456789';
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      telegramId = String(tg.initDataUnsafe.user.id);
    }
    
    console.log('Telegram ID:', telegramId);
    
    // ============================================
    // –ü–û–õ–ù–´–ô –í–ó–õ–û–ú –ü–†–û–ö–†–£–¢–ö–ò –Ø–ù–î–ï–ö–°.–§–û–†–ú–´
    // ============================================
    
    function hackYandexFormScrolling(iframe) {
      if (!iframe) return;
      
      try {
        // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É iframe
        const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
        
        if (iframeDoc) {
          console.log('–î–æ—Å—Ç—É–ø –∫ iframe –ø–æ–ª—É—á–µ–Ω, –≤–∑–ª–∞–º—ã–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É...');
          
          // 1. –£–ë–ò–†–ê–ï–ú embed.js –∏ –µ–≥–æ —Å—Ç–∏–ª–∏
          const embedScript = iframeDoc.querySelector('script[src*="embed.js"]');
          if (embedScript) embedScript.remove();
          
          // 2. –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–Ø–ï–ú –°–¢–ò–õ–ò
          const style = iframeDoc.createElement('style');
          style.textContent = `
            /* –ü–û–õ–ù–û–°–¢–¨–Æ –û–¢–ö–õ–Æ–ß–ê–ï–ú –ë–õ–û–ö–ò–†–û–í–ö–£ –ü–†–û–ö–†–£–¢–ö–ò */
            html, body {
              overflow: visible !important;
              overflow-y: visible !important;
              overflow-x: hidden !important;
              height: auto !important;
              min-height: 100% !important;
              position: static !important;
            }
            
            /* –†–ê–ó–†–ï–®–ê–ï–ú –ü–†–û–ö–†–£–¢–ö–£ –í–°–ï–ú –ö–û–ù–¢–ï–ô–ù–ï–†–ê–ú */
            div, section, article, main, form {
              overflow: visible !important;
              overflow-y: visible !important;
              max-height: none !important;
            }
            
            /* –£–ë–ò–†–ê–ï–ú –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ï –ü–û–ó–ò–¶–ò–ò */
            .form__footer, 
            [class*="sticky"],
            [class*="fixed"] {
              position: static !important;
            }
            
            /* –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –í–´–°–û–¢–£ –ö–û–ù–¢–ï–ô–ù–ï–†–û–í */
            .form, 
            .form__content,
            [class*="form-"],
            [id*="form-"] {
              height: auto !important;
              min-height: 100% !important;
            }
          `;
          
          iframeDoc.head.appendChild(style);
          
          // 3. –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –í–ö–õ–Æ–ß–ê–ï–ú –ü–†–û–ö–†–£–¢–ö–£ –£ BODY
          iframeDoc.body.style.overflow = 'visible';
          iframeDoc.body.style.overflowY = 'visible';
          iframeDoc.body.style.height = 'auto';
          iframeDoc.documentElement.style.overflow = 'visible';
          iframeDoc.documentElement.style.overflowY = 'visible';
          
          // 4. –£–î–ê–õ–Ø–ï–ú –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò, –ö–û–¢–û–†–´–ï –ë–õ–û–ö–ò–†–£–Æ–¢ –°–ö–†–û–õ–õ
          iframeDoc.body.addEventListener('touchmove', function(e) {
            e.stopPropagation(); // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º, –¥–∞—ë–º –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å—Å—è
          }, { passive: false, capture: true });
          
          console.log('‚úÖ –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–∑–ª–æ–º–∞–Ω–∞!');
        }
      } catch (e) {
        console.log('‚ùå –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ iframe, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å');
        
        // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (same-origin), –∏—Å–ø–æ–ª—å–∑—É–µ–º postMessage
        iframe.contentWindow?.postMessage({
          type: 'hack-scrolling',
          command: 'enableScroll'
        }, 'https://forms.yandex.ru');
      }
    }
    
    // ============================================
    // –ò–ó–ú–ï–†–ï–ù–ò–ï –†–ï–ê–õ–¨–ù–û–ô –í–´–°–û–¢–´
    // ============================================
    
    function resizeIframeToContent(iframe) {
      if (!iframe) return;
      
      try {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
        
        if (iframeDoc) {
          // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
          const height = Math.max(
            iframeDoc.body.scrollHeight,
            iframeDoc.body.offsetHeight,
            iframeDoc.documentElement.scrollHeight,
            iframeDoc.documentElement.offsetHeight,
            iframeDoc.body.clientHeight,
            iframeDoc.documentElement.clientHeight
          );
          
          if (height > 100) {
            iframe.style.height = height + 'px';
            iframe.style.minHeight = height + 'px';
            console.log('üìè –í—ã—Å–æ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', height);
            
            // –¢–∞–∫–∂–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            const container = document.getElementById('scrollContainer');
            if (container) {
              // –ù–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
              container.style.maxHeight = 'none';
            }
          }
        }
      } catch (e) {
        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ—Ä–∏—Ç—å –≤—ã—Å–æ—Ç—É');
      }
    }
    
    // ============================================
    // –°–û–ó–î–ê–ù–ò–ï IFRAME
    // ============================================
    
    function createIframe() {
      const container = document.getElementById('scrollContainer');
      container.innerHTML = '';
      
      // –í–ê–ñ–ù–û: –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–ú embed.js –Ø–ù–î–ï–ö–°–ê!
      document.getElementById('loading').style.display = 'block';
      
      const iframe = document.createElement('iframe');
      
      const formUrl = `https://forms.yandex.ru/cloud/638f4e9390fa7b1cb30872ac/?iframe=1&answer_short_text_9008969702497836=${encodeURIComponent(telegramId)}`;
      
      iframe.src = formUrl;
      iframe.frameBorder = '0';
      iframe.name = 'ya-form-638f4e9390fa7b1cb30872ac';
      iframe.style.width = '100%';
      iframe.style.height = '100vh'; // –ù–∞—á–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞
      iframe.style.minHeight = '100vh';
      iframe.style.overflow = 'visible'; // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
      iframe.style.overflowY = 'visible';
      
      iframe.onload = function() {
        document.getElementById('loading').style.display = 'none';
        console.log('Iframe –∑–∞–≥—Ä—É–∂–µ–Ω');
        
        // 1. –°—Ä–∞–∑—É –ø—ã—Ç–∞–µ–º—Å—è –≤–∑–ª–æ–º–∞—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É
        setTimeout(() => hackYandexFormScrolling(iframe), 1000);
        setTimeout(() => hackYandexFormScrolling(iframe), 2000);
        setTimeout(() => hackYandexFormScrolling(iframe), 3000);
        
        // 2. –ò–∑–º–µ—Ä—è–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
        setTimeout(() => resizeIframeToContent(iframe), 1500);
        setTimeout(() => resizeIframeToContent(iframe), 2500);
        setTimeout(() => resizeIframeToContent(iframe), 3500);
        setTimeout(() => resizeIframeToContent(iframe), 5000);
        
        // 3. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        const interval = setInterval(() => {
          resizeIframeToContent(iframe);
        }, 2000);
        
        setTimeout(() => clearInterval(interval), 30000);
      };
      
      container.appendChild(iframe);
    }

    // –ó–ê–ü–£–°–ö
    window.addEventListener('load', createIframe);
    setTimeout(createIframe, 1000);
    
    // ============================================
    // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–ö–†–£–¢–ö–ê –ö–û–ù–¢–ï–ô–ù–ï–†–ê
    // ============================================
    
    const container = document.getElementById('scrollContainer');
    if (container) {
      // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ–∂–∏–º—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
      container.style.overflowY = 'scroll';
      container.style.overflowY = 'auto';
      container.style.webkitOverflowScrolling = 'touch';
      container.style.maxHeight = 'none';
      container.style.height = 'auto';
      container.style.position = 'relative';
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ–ª—å—à—É—é –≤—ã—Å–æ—Ç—É –¥–ª—è —Ç–µ—Å—Ç–∞
      container.style.minHeight = '200vh';
    }
    
    // ============================================
    // –§–ò–ù–ê–õ–¨–ù–´–ô –£–î–ê–† - –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê –ë–ï–ó EMBED.JS
    // ============================================
    
    setTimeout(() => {
      const iframe = document.querySelector('iframe');
      if (iframe) {
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º iframe –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ iframe=1
        // —á—Ç–æ–±—ã –Ø–Ω–¥–µ–∫—Å –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–ª embed.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        const newUrl = `https://forms.yandex.ru/cloud/638f4e9390fa7b1cb30872ac/?answer_short_text_9008969702497836=${encodeURIComponent(telegramId)}`;
        iframe.src = newUrl;
        console.log('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –±–µ–∑ embed.js');
      }
    }, 4000);
    
  </script>

</body>
</html>
