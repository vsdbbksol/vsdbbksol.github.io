<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>TMA</title>
  <script src="https://telegram.org/js/telegram-web-app.js?59"></script>

  <style>
    /* Разрешаем прокрутку документа в целом */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, avenir next, avenir, segoe ui, helvetica neue, Adwaita Sans, Cantarell, Ubuntu, roboto, noto, helvetica, arial, sans-serif;
      background: #fff;
      display: flex;
      flex-direction: column;
    }

    /* Контейнер, внутри которого будет iframe */
    .scrollable-container {
      flex: 1 1 auto;
      width: 100%;
      height: 100%;
      overflow: hidden; /* отключаем внешнюю прокрутку внутри этого контейнера */
      position: relative;
    }

    /* Сам iframe: не ограничиваем его прокрутку вовне; внутри iframe — своя прокрутка */
    iframe {
      width: 100%;
      height: 100%;          /* занимать всю высоту контейнера; содержимое внутри iframe прокручивается само по себе */
      min-height: 1000px;
      border: none;
      display: block;
      background: white;
      overflow: auto;        /* разрешаем внутри iframe прокрутку (если поддерживает хозяин контента) */
    }

    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      z-index: 10000;
      display: none;
    }
  </style>
</head>

<body>

  <div class="loading" id="loading">Загрузка формы...</div>

  <!-- КОНТЕЙНЕР С ПРОКРУТКОЙ (только внутри себя, внешний документ не ограничивает прокрутку) -->
  <div id="scrollContainer" class="scrollable-container">
    <!-- iframe будет вставлен сюда программно -->
  </div>

  <script>
    // ============================================
    // ИНИЦИАЛИЗАЦИЯ TELEGRAM
    // ============================================
    const tg = window.Telegram.WebApp;

    // Отключаем свайпы закрытия
    if (typeof tg.disableVerticalSwipes === 'function') {
      tg.disableVerticalSwipes();
    }

    // Разворачиваем на весь экран
    tg.expand();

    // Получаем Telegram ID
    let telegramId = '123456789';
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      telegramId = String(tg.initDataUnsafe.user.id);
    }

    console.log('Telegram ID:', telegramId);

    // ============================================
    // СОЗДАНИЕ IFRAME С ФИКСИРОВАННОЙ ВЫСОТОЙ
    // Теперь прокрутка внутри iframe
    // ============================================
    function createIframe() {
      const container = document.getElementById('scrollContainer');
      container.innerHTML = '';

      document.getElementById('loading').style.display = 'block';

      const iframe = document.createElement('iframe');

      // URL с Telegram ID
      const formUrl = `https://forms.yandex.ru/cloud/638f4e9390fa7b1cb30872ac/?iframe=1&answer_short_text_9008969702497836=${encodeURIComponent(telegramId)}`;

      iframe.src = formUrl;
      iframe.name = 'ya-form-638f4e9390fa7b1cb30872ac';
      iframe.setAttribute('frameBorder', '0');
      iframe.setAttribute('scrolling', 'yes');
      iframe.setAttribute('seamless', 'seamless');

      // Без фиксированной внешней высоты: внешний контейнер не ограничивает прокрутку
      iframe.style.height = '100%';
      iframe.style.minHeight = '1000px';
      iframe.style.maxHeight = 'none';

      iframe.onload = function() {
        document.getElementById('loading').style.display = 'none';
        console.log('✅ Форма загружена');
      };

      container.appendChild(iframe);
    }

    // Запускаем создание iframe
    window.addEventListener('load', createIframe);
    setTimeout(createIframe, 1000);

    // ============================================
    // УДАЛЕНИЕ ВСЕХ ПРИНУДИТЕЛЬНЫХ прокруток
    // ============================================

    // Подсказка для пользователя
    setTimeout(() => {
      const hint = document.createElement('div');
      hint.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 30px;
        font-size: 14px;
        z-index: 10001;
        animation: fadeOut 3s forwards;
        pointer-events: none;
      `;
      hint.textContent = '⬇️ Прокрутите внутри формы, чтобы продолжить';

      const style = document.createElement('style');
      style.textContent = `
        @keyframes fadeOut {
          0% { opacity: 1; }
          70% { opacity: 1; }
          100% { opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      document.body.appendChild(hint);

      setTimeout(() => hint.remove(), 3000);
    }, 1500);
  </script>

</body>
</html>
