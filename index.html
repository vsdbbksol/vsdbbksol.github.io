<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>TMA</title>
  <script src="https://telegram.org/js/telegram-web-app.js?59"></script>

  <style>
    /* ПОЛНОЭКРАННЫЙ РЕЖИМ (без отключения прокрутки всего документа) */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      /* Убираем запрет прокрутки на уровне документа */
      overflow: auto;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, avenir next, avenir, segoe ui, helvetica neue, Adwaita Sans, Cantarell, Ubuntu, roboto, noto, helvetica, arial, sans-serif;
      background: #fff;
      display: flex;
      flex-direction: column;
    }

    /* КОНТЕЙНЕР С ПРОКРУТКОЙ (на уровне документа) */
    .scrollable-container {
      flex: 1;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      position: relative;
    }

    /* ИФРАЙМ без фикса высоты: позволим прокручивать содержимое внутри iframe */
    iframe {
      width: 100%;
      border: none;
      display: block;
      background: white;
      height: 1000px;      /* начальная высота; будет растягиваться внутри iframe контентом */
      min-height: 1000px;
      max-height: none;
    }

    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      z-index: 10000;
      display: none;
    }
  </style>
</head>

<body>

  <div class="loading" id="loading">Загрузка формы...</div>
  
  <!-- КОНТЕЙНЕР С ПРОКРУТКОЙ -->
  <div id="scrollContainer" class="scrollable-container"></div>

  <script>
    // ============================================
    // ИНИЦИАЛИЗАЦИЯ TELEGRAM
    // ============================================
    const tg = window.Telegram.WebApp;
    
    // Отключаем свайпы закрытия
    if (typeof tg.disableVerticalSwipes === 'function') {
      tg.disableVerticalSwipes();
    }
    
    // Разворачиваем на весь экран
    tg.expand();
    
    // Получаем Telegram ID
    let telegramId = '123456789';
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      telegramId = String(tg.initDataUnsafe.user.id);
    }
    
    console.log('Telegram ID:', telegramId);
    
    // ============================================
    // СОЗДАНИЕ IFRAME С ФИКСИРОВАННОЙ ВЫСОТОЙ
    // Теперь прокрутка внутри iframe
    // ============================================
    
    function createIframe() {
      const container = document.getElementById('scrollContainer');
      container.innerHTML = '';
      
      document.getElementById('loading').style.display = 'block';
      
      const iframe = document.createElement('iframe');
      
      // URL с Telegram ID
      const formUrl = `https://forms.yandex.ru/cloud/638f4e9390fa7b1cb30872ac/?iframe=1&answer_short_text_9008969702497836=${encodeURIComponent(telegramId)}`;
      
      iframe.src = formUrl;
      iframe.frameBorder = '0';
      iframe.name = 'ya-form-638f4e9390fa7b1cb30872ac';
      
      // Без фиксации внешней высоты: контент внутри iframe управляет своей прокруткой
      iframe.style.width = '100%';
      iframe.style.height = '1000px';       // стартовая высота, можно увеличить/оптимизировать под нужды
      iframe.style.minHeight = '1000px';
      iframe.style.maxHeight = 'none';
      
      // ЯВНО РАЗРЕШАЕМ ПРОКРУТКУ внутри iframe (контент внутри iframe будет прокручиваться)
      iframe.setAttribute('scrolling', 'yes');
      iframe.setAttribute('seamless', 'seamless');
      
      iframe.onload = function() {
        document.getElementById('loading').style.display = 'none';
        console.log('✅ Форма загружена, высота iframe: 1000px');
        // Никакой принудительной прокрутки внешнего контейнера
      };
      
      container.appendChild(iframe);
    }

    // Запускаем создание iframe
    window.addEventListener('load', createIframe);
    setTimeout(createIframe, 1000);
    
    // ============================================
    // АКТИВАЦИЯ ПРОКРУТКИ КОНТЕЙНЕРА (остаточно для корректной прокрутки внутри iframe)
    // ============================================
    // Теперь прокрутка внешнего контейнера не нужна для прокрутки содержимого iframe.
    // Но оставим настройки, чтобы внешний контейнер тоже корректно работал.
    const container = document.getElementById('scrollContainer');
    if (container) {
      container.style.overflowY = 'auto';
      container.style.overflowY = 'scroll';
      container.style.webkitOverflowScrolling = 'touch';
      container.style.maxHeight = 'none';
      container.style.height = '100%';
    }
    
    // ============================================
    // ПОДСКАЗКА ДЛЯ ПОЛЬЗОВАТЕЛЯ
    // ============================================
    
    setTimeout(() => {
      const hint = document.createElement('div');
      hint.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 30px;
        font-size: 14px;
        z-index: 10001;
        animation: fadeOut 3s forwards;
        pointer-events: none;
      `;
      hint.textContent = '⬇️ Прокрутите внутри формы, чтобы продолжить';
      
      // Добавляем анимацию
      const style = document.createElement('style');
      style.textContent = `
        @keyframes fadeOut {
          0% { opacity: 1; }
          70% { opacity: 1; }
          100% { opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(hint);
      
      // Удаляем подсказку через 3 секунды
      setTimeout(() => hint.remove(), 3000);
    }, 1500);
    
  </script>

</body>
</html>
